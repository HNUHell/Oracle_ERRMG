# ORA-02100 to ORA-04099

## ORA-02437: 无法验证 (【SCHEMA名】.【主键名】) - 违反主键

> ORA-02437: cannot validate (string.string) - primary key violated

### 原因1: 尝试使用重复值或空值验证主键。
> attempted to validate a primary key with duplicate values or null values.

* **状态**: 已验证。
* **分析**: 创建主键约束时启用对已有数据的校验，或创建主键约束时禁用对已有数据的校验但约束对应的索引是唯一索引仍进行了校验。校验时表中约束列存在重复值或者空值（空值有疑虑，测试发现先校验空值报ORA-01449: 列包含 NULL 值; 无法将其变更为 NOT NULL），以致无法创建主键而报错，如下例所示: 

  ```sql
  -- 创建表与主键
  create table ora_02437_1(a number, b varchar2(30));
  -- 插入重复数据
  insert into ora_02437_1(a,b) values(1,'1');
  insert into ora_02437_1(a,b) values(1,'1');
  -- 创建主键报错
  alter table ora_02437_1 add constraints pk_ora_02437_1_a primary key(a)
  --(enable) (validate) -- 默认enable启用约束，且默认validate对已有数据进行校验
  ;
  -- 创建主键限制不对已有数据进行校验，仍然报错
  alter table ora_02437_1 add constraints pk_ora_02437_1_a primary key(a) enable novalidate ;
  -- 查看没有索引，但约束使用须有索引，而在创建唯一约束时系统默认给创建唯一索引，所以上条语句会报错
  select t.status, t.* from user_indexes t where t.table_name = 'ORA_02437_1';
  ```

* **措施**: 在启用主键之前，请删除重复项和空值。
  > remove the duplicates and null values before enabling a primary key.
  
  - 如果需要对已有数据进行校验并添加主键，则需查询表并清除重复项和空值，而后再创建主键约束。
  - 如果不需要对已有数据进行校验，则需先创建普通索引，再创建主键约束且加novalidate限制。

    ```sql
    -- 先创建索引
    create index pk_ora_02437_1_a on ora_02437_1(a)
    -- online --可同时加online参数保证创建索引的时候不阻塞DML操作，以免对运行中的系统造成影响
    ;
    -- 再创建主键
    alter table ora_02437_1 add constraints pk_ora_02437_1_a primary key(a)  novalidate ;
    -- 清除重复项和空值后可再启动对已有数据校验
    alter table ora_02437_1 modify constraint pk_ora_02437_1_a validate;
    ```
	